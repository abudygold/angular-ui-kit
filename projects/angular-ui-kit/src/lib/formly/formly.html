@if (formConfig()) {
	<div [class]="formConfig()?.formClass || ''">
		@for (fc of formConfig()?.fields || []; track fc.key; let fcIndex = $index) {
			<ng-container
				*ngTemplateOutlet="fieldRenderer; context: { field: fc, fieldIndex: fcIndex }" />
		}
	</div>
}

<ng-template #fieldRenderer let-field="field" let-fieldIndex="fieldIndex">
	<div [class]="field?.fieldClass || ''">
		@switch (field.type) {
			@case ('textbox') {
				<lib-textbox [field]="field" [class.no-hint]="!field?.config?.hint" />
			}

			@case ('textarea') {
				<lib-textarea [field]="field" [class.no-hint]="!field?.config?.hint" />
			}

			@case ('dropdown') {
				<lib-dropdown [field]="field" [class.no-hint]="!field?.config?.hint" />
			}

			@case ('autocomplete') {
				<lib-autocomplete [field]="field" [class.no-hint]="!field?.config?.hint" />
			}

			@case ('datepicker') {
				<lib-datepicker [field]="field" [class.no-hint]="!field?.config?.hint" />
			}

			@case ('checkbox') {
				<lib-checkbox [field]="field" />
			}

			@case ('radio') {
				<lib-radio-button [field]="field" />
			}

			@case ('slide-toggle') {
				<lib-slide-toggle [field]="field" />
			}

			@case ('chip') {
				<lib-chip [field]="field" />
			}

			@case ('array') {
				@for (
					row of field?.control().value() || [];
					track rowIndex;
					let rowIndex = $index
				) {
					<mat-accordion [class]="field.panelClass?.accordion || ''">
						<mat-expansion-panel
							[expanded]="true"
							[class]="field.panelClass?.panel || ''">
							<mat-expansion-panel-header [class]="field.panelClass?.header || ''">
								<mat-panel-title [class]="field.panelClass?.title || ''">
									{{
										field.title
											? field.title + ' ' + (rowIndex + 1)
											: 'Item ' + (rowIndex + 1)
									}}
								</mat-panel-title>
							</mat-expansion-panel-header>

							<div [class]="field.removeClass?.div || ''">
								<button
									matIconButton
									aria-label="delete icon"
									[class]="field.removeClass?.btn || ''"
									(click)="removeItem(field.control, rowIndex)">
									<mat-icon class="tw:text-red-500!">delete</mat-icon>
								</button>
							</div>

							<div [class]="field.panelClass?.content || ''">
								@for (fc of field?.fields; track fc.key; let fcIndex = $index) {
									<ng-container
										*ngTemplateOutlet="
											fieldRenderer;
											context: {
												field: {
													...fc,
													control: field.control[rowIndex][fc.key],
												},
											}
										" />
								}
							</div>
						</mat-expansion-panel>
					</mat-accordion>
				}

				<div [class]="field.addClass?.div || ''">
					<button
						matButton="outlined"
						[class]="field.addClass?.btn || ''"
						(click)="addItem(field)">
						{{ field.addBtnLabel || 'Add Item' }}
					</button>
				</div>
			}
		}

		@if (field.control().touched() && field.control().invalid()) {
			@for (error of field.control().errors(); track error.kind) {
				<mat-error>{{ error.message }}</mat-error>
			}
		}
	</div>
</ng-template>
